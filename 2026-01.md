# 2026-01

## 2026-01-15

### Heisenbug Fix: /random
- **Issue**: The `/random` endpoint occasionally redirected to nodes starting with `go/`, which triggered the `go` action and redirected the user to an external URL, breaking the Demo Mode loop.
- **Fix**: Implemented a retry loop (max 5 attempts) in `app/agora.py`'s `random()` route to ensure the selected node does not start with `go/`.

### Worker & Caching Overhaul
- **Goal**: Make `/latest` and other heavy views fast by pre-warming the cache.
- **Worker**: Updated `scripts/worker.py` (via `app/storage/maintenance.py`) to explicitly regenerate expensive queries (`/latest`, `/nodes`, `/users`, `/journals`) after every graph rebuild.
- **Refactor**: Cleaned up legacy cache keys (`_v1`, `_v2`) to simplify the caching logic.
- **Observability**: Configured the worker to log `INFO` messages to `stdout`, making it visible in `journalctl`.
- **Systemd**: Added `conf/agora-server-worker.service` and `.timer` for robust production scheduling.

### Feature: /stats Dashboard
- **New Route**: Added `/stats` to provide a real-time health check of the Agora.
- **Metrics**: Displays Node/Edge/User/Contribution counts.
- **Health Indicators**:
  - **Memory State**: Hot (in-memory) vs Cold.
  - **Worker Status**: Active (recent run) vs Stale/Inactive.
  - **SQLite State**: Available (with file size).
  - **Graph Rebuild**: Time since last full index (with fallback to DB mtime).
- **Management**: Moved "Flush Cache" buttons from the footer to `/stats`.
- **Transclusion**: The `[[stats]]` node content is transcluded at the bottom using standard Agora UI.

### UI Improvements
- **Utility Pages**: Added standard `[[node]]` transclusion to the bottom of `/starred`, `/latest`, `/users`, `/journals`, `/nodes`, and `/federation`.
- **Navigation**: Removed the "Retry" button from the footer (moved to Navbar, then removed entirely).
- **Cleanup**: Simplifed `/stats` layout for mobile compatibility (removed connectors, used CSS grid).

---
