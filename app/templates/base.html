<!DOCTYPE html>
<!--
 Copyright 2020 Google LLC

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->

<html>

<head>
	<meta charset="utf-8" />
	{% if node is defined and node.qstr %}
	<title>[[{{node.qstr}}]] at {{config['URI_BASE']}}</title>
	{% else %}
    <title>{{config['AGORA_NAME']}} at {{config['URI_BASE']}}</title>
	{% endif %}
	<!-- This Agora is: {{config['URI_BASE']}} -->
	{% if 'dev.' in config['URI_BASE'] %}
	<!-- This is a development Agora, so it's likely better if it's not indexed (it might not be up most of the time). -->
	<meta name="robots" content="noindex" />
	{% endif %}

    <script>
      // IIFE to prevent leaking variables into global scope
      (function() {
        try {
          // 1. Read theme from localStorage
          var theme = localStorage.getItem('theme');
          if (theme) {
            // 2. If it exists, apply it to the root <html> element
            document.documentElement.setAttribute('data-theme', theme);
          }
        } catch (e) {
          // If localStorage is disabled or unavailable, just log an error
          console.error('Could not apply theme from localStorage', e);
        }
      })();
    </script>

	<meta name="description" content="The Agora is a free knowledge commons: {{config['URI_BASE']}}." />
	<meta name="HandheldFriendly" content="True" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="search" type="application/opensearchdescription+xml" title="Agora" href={{config['URL_BASE']}}{{url_for('agora.search_xml')}} />
	<link rel="stylesheet" media="screen" type="text/css"
		href="{{ url_for('static',filename='css/main.css')}}?v={{css_versions.main_css_version}}" />

	<script>
		const APIBASE = "{{config['API_BASE']}}";
		const AGORANAME = "{{config['AGORA_NAME']}}";
		const AGORAURI= "{{config['URI_BASE']}}";
		const AGORAURL = "{{config['URL_BASE']}}";
	</script>

	{% if node is defined %}
	<script>
		const NODENAME = "{{node.uri}}";
		const NODEQ = "{{node.q}}";
		const ARG = "{{argument}}";
		const WIKILINK = "{{node.wikilink}}";
		const NODEDESC = "{{node.description}}";
	</script>
	{% endif %}

	{% if not embed %}
    <!-- we used to not load some of these JS modules in embeds, but that breaks graphs -->
	{% endif %}
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

	<script type="module" src="{{url_for('static', filename='js/index.js')}}"></script>

	<script type="application/json" class="js-hypothesis-config">
    {
      "externalContainerSelector": "#hypothesis-client-container"
    }
	</script>
    {% if config.ENABLE_HYPOTHESIS %}
	<script async src="https://hypothes.is/embed.js"></script>
    {% endif %}

</head>

<body>

    {% include "overlay.html" %}
    {% include "join_overlay.html" %}

    <nav>
        {% if not embed %}
        <!-- navigation chrome is simplified if embed=True -->
        <div class="navigation">
            <div class="navigation-content">
                <div style="display: flex; align-items: center; gap: 0.5em;">
                    <div class="burger" id="burger" style="display: flex; align-items: center; gap: 0.25em; cursor: pointer;">
                        <span>‚ò∞</span>
                        <img src="/static/img/agora.png" class="logo" width="36px" height="36px" title="An Agora is a Free Knowledge Commons.">
                    </div>
                    <a href="/" style="text-decoration: none; display: flex; flex-direction: column; align-items: center; line-height: 1.1; margin-left: 0.2em;" title="You are in the {{config['AGORA_NAME']}}. This Agora is one of many.">
                        <span class="hide-on-mobile" style="font-size: 0.75em; font-weight: normal; opacity: 0.9;">{{config['AGORA_NAME']}}</span>
                        <span style="font-weight: bold; font-size: 0.9em;">{{config['URI_BASE']}}</span>
                    </a>
                </div>
                ‚ûú
                <a href="/nodes" class="navlink" style="text-decoration: none;"><span class="navbar-item"><span>üìö</span><span>all</span></span></a>
                {{config['MENU_SEPARATOR']}} <a href="/random" style="text-decoration: none;"><span class="navbar-item"><span>üé≤Ô∏è</span><span>random</span></span></a>
                {{config['MENU_SEPARATOR']}} <a href="/starred" style="text-decoration: none;"><span class="navbar-item"><span>‚ú®</span><span>starred</span></span></a>
                {{config['MENU_SEPARATOR']}} <a href="/latest" style="text-decoration: none;"><span class="navbar-item"><span>üå±</span><span>latest</span></span></a>
                {{config['MENU_SEPARATOR']}} <a href="/journals/365" style="text-decoration: none;"><span class="navbar-item"><span>üìú</span><span>journals</span></span></a>
                {{config['MENU_SEPARATOR']}} <a href="/today" style="text-decoration: none;"><span class="navbar-item"><span>üìÜ</span><span>today</span></a>
                {{config['MENU_SEPARATOR']}} <a href="/annotations" style="text-decoration: none;"><span class="navbar-item"><span>üñãÔ∏è</span><span>annotations</span></span></a>
                {{config['MENU_SEPARATOR']}} <a title="Commoners" href="/users" style="text-decoration: none;"><span class="navbar-item"><span>ü´Ç</span><span>users</span></span></a>
                {{config['MENU_SEPARATOR']}} <a href="#" style="text-decoration: none;" id="join"><span class="navbar-item"><span>üí™</span><span>join</span></span></a>
                <div class="toggle-container">
                    <label class="theme-switch" for="theme-checkbox" title="Toggle light/dark theme">
                        <input type="checkbox" id="theme-checkbox" class="theme-checkbox-input" />
                        <div class="slider round"></div>
                    </label>
                    {% if config.ENABLE_DEMO %}
                    <label class="demo-switch" for="demo-checkbox" title="Toggle Demo Mode">
                        <input type="checkbox" id="demo-checkbox" class="demo-checkbox-input" />
                        <div class="slider round">
                            <span id="demo-timer"></span>
                        </div>
                    </label>
                    {% endif %}
                    <label class="music-switch" for="music-checkbox" title="Toggle Ambient Music">
                        <input type="checkbox" id="music-checkbox" class="music-checkbox-input" />
                        <div class="slider round"></div>
                    </label>
                    <button id="scroll-toggle" title="Scroll to bottom / top">‚ñº</button>
                </div>
	        </div>
        </div>
        {% endif %}

        <div class="topline-node">
            <div class="topline-node-wrapper">
                <div class="search-container">
                    <button id="mini-cli-exec" value="exec" title="Search the Agora and the web for the text in the input box.">
                        üîé search
                    </button>
                    <div class="topline-cli">
                        <form action="/" method="get">
                            <input id="mini-cli" type="text" value="{{node.qstr}}" name="q">
                        </form>
                    </div>
                    <!-- Toggles will be moved here by JS on mobile -->
                </div>
                <div class="action-bar">
                    <button id="mini-cli-go" value="go" title="Follow a [[go]] link in the Agora, or try an 'I'm Feeling Lucky' search.">
                        ‚û°Ô∏è go
                    </button>
                    <button id="expand-all" value="expand" title="Expand all sections.">
    					‚äû expand
                    </button>
                    <button id="annotate-button" title="Toggle annotations">üñãÔ∏è Annotate</button>
                    <button id="show-meditation-popup" title="Agora Meditation: a moment of calm.">üôè Meditate</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="content">
    {% block content %}
    {% endblock %}

    </div> <!-- end content -->

    {% if config.ENABLE_HYPOTHESIS %}
    <div id='hypothesis-frame'>
        <div id="hypothesis-controls">
            <span id="hypothesis-drag-handle">Hypothes.is</span>
            <span id="hypothesis-close-btn">x</span>
        </div>
        <div id="hypothesis-client-container"></div>
    </div>
    {% endif %}

    <div id="meditation-popup-container">
        <div id="meditation-popup">
            <div id="meditation-popup-header">
                <span id="meditation-popup-title">Agora Meditation</span>
                <span id="meditation-popup-close-btn">x</span>
            </div>
            <div id="meditation-popup-content">
                <!-- Content will be loaded here by demo.ts -->
            </div>
        </div>
    </div>

<div id="music-player-container">
    <div id="music-player-header">
      <span id="music-player-title">‚ô´ Ambient Music</span>
      <button id="music-player-close-btn" class="header-btn">√ó</button>
    </div>
    <div class="music-player-body">
        <div id="track-info">
            <span id="music-player-track-name"></span> <span id="music-player-artist-name"></span>
        </div>
        <div id="music-player-autoplay-message" style="display: none; cursor: pointer;"></div>
        <div id="music-player-controls">
            <button id="music-player-prev" class="control-btn">‚èÆ</button>
            <button id="music-player-pause" class="control-btn">‚è∏</button>
            <button id="music-player-next" class="control-btn">‚è≠</button>
        </div>
    </div>
    </div>

    <div id="toast-container"></div>
</body>

</html>
